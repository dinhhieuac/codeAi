<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAUUSD Bot Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
        }

        .profit-pos {
            color: green;
            font-weight: bold;
        }

        .profit-neg {
            color: red;
            font-weight: bold;
        }

        .badge-buy {
            background-color: #198754;
        }

        .badge-sell {
            background-color: #dc3545;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">ðŸ¤– XAUUSD Trading Bot Dashboard</span>
            <span class="text-white"><i class="fas fa-sync"></i> Auto-refreshing usually requires JS, hit F5
                manually</span>
        </div>
    </nav>

    <div class="container">
        <!-- Stats Row -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title">Total Trades</h5>
                        <h2 class="card-text">{{ total_trades }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card {% if total_profit >= 0 %}bg-success{% else %}bg-danger{% endif %} text-white">
                    <div class="card-body">
                        <h5 class="card-title">Total Profit ($)</h5>
                        <h2 class="card-text">{{ "%.2f"|format(total_profit) }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <h5 class="card-title">Win Rate</h5>
                        <h2 class="card-text">{{ "%.1f"|format(win_rate) }}%</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-secondary text-white">
                    <div class="card-body">
                        <h5 class="card-title">W / L</h5>
                        <h2 class="card-text">{{ wins }} / {{ losses }}</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot Performance Stats -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-robot"></i> Strategy Performance</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Strategy</th>
                                <th>Trades</th>
                                <th>Win Rate</th>
                                <th>Profit Factor</th>
                                <th>Avg Win</th>
                                <th>Avg Loss</th>
                                <th>Net Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for bot in bot_stats %}
                            <tr>
                                <td class="fw-bold text-primary">{{ bot.name }}</td>
                                <td>{{ bot.trades }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <span class="me-2">{{ "%.1f"|format(bot.win_rate) }}%</span>
                                        <div class="progress flex-grow-1" style="height: 6px; width: 60px;">
                                            <div class="progress-bar {% if bot.win_rate >= 50 %}bg-success{% else %}bg-warning{% endif %}"
                                                role="progressbar" style="width: {{ bot.win_rate }}%"></div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    {% if bot.pf >= 1.5 %}
                                    <span class="badge bg-success">{{ "%.2f"|format(bot.pf) }}</span>
                                    {% elif bot.pf >= 1.0 %}
                                    <span class="badge bg-primary">{{ "%.2f"|format(bot.pf) }}</span>
                                    {% else %}
                                    <span class="badge bg-danger">{{ "%.2f"|format(bot.pf) }}</span>
                                    {% endif %}
                                </td>
                                <td class="text-success">{{ "$%.2f"|format(bot.avg_win) }}</td>
                                <td class="text-danger">{{ "$%.2f"|format(bot.avg_loss) }}</td>
                                <td
                                    class="fw-bold {% if bot.net_profit >= 0 %}text-success{% else %}text-danger{% endif %}">
                                    {{ "$%.2f"|format(bot.net_profit) }}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Orders Table -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-history"></i> Trade History</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Ticket</th>
                                <th>Time</th>
                                <th>Strategy</th>
                                <th>Symbol</th>
                                <th>Type</th>
                                <th>Vol</th>
                                <th>Price</th>
                                <th>SL</th>
                                <th>TP</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <tr>
                                <td>{{ order.ticket }}</td>
                                <td>{{ order.open_time }}</td>
                                <td><span class="badge bg-secondary">{{ order.strategy_name }}</span></td>
                                <td>{{ order.symbol }}</td>
                                <td>
                                    {% if order.order_type == 'BUY' %}
                                    <span class="badge badge-buy">BUY</span>
                                    {% else %}
                                    <span class="badge badge-sell">SELL</span>
                                    {% endif %}
                                </td>
                                <td>{{ order.volume }}</td>
                                <td>{{ order.open_price }}</td>
                                <td>{{ order.sl }}</td>
                                <td>{{ order.tp }}</td>
                                <td
                                    class="{% if order.profit is not none and order.profit >= 0 %}profit-pos{% elif order.profit is not none %}profit-neg{% endif %}">
                                    {% if order.profit is not none %}
                                    {{ "%.2f"|format(order.profit) }}
                                    {% else %}
                                    <span class="text-muted">Running</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recent Signals -->
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-signal"></i> Recent Signals (Last 50)</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Strategy</th>
                                <th>Signal</th>
                                <th>Price</th>
                                <th>Info</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sig in signals %}
                            <tr>
                                <td>{{ sig.timestamp }}</td>
                                <td>{{ sig.strategy_name }}</td>
                                <td>
                                    {% if sig.signal_type == 'BUY' %}
                                    <span class="text-success fw-bold">BUY</span>
                                    {% else %}
                                    <span class="text-danger fw-bold">SELL</span>
                                    {% endif %}
                                </td>
                                <td>{{ sig.price }}</td>
                                <td class="small text-muted">{{ sig.indicators }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>